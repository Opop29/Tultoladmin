import{j as e,v as ve,d as te,w as se,x as le,y as we,z as ae,e as ne,O as Se,P as oe,k as N,m as A,i as D,l as I,H as $,J as Ce,K as Ne}from"./ionic-Bk_P96ZF.js";import{r as o}from"./vendor-NXI3fooF.js";import{h as L,n as De}from"./index-BCR8R_7f.js";import{m as j}from"./mapbox-gl-DzlfilDF.js";import{s as y}from"./supabaseClient-DzfNh-zC.js";import"./supabase-Dfjzly43.js";const ze=()=>{const[m,ie]=o.useState([]),[t,n]=o.useState(null),[c,k]=o.useState([]),[M,z]=o.useState(!1),[V,de]=o.useState(new Date().toISOString()),[g,h]=o.useState(null),R=o.useRef(null),b=o.useRef(null),[ce,T]=o.useState(!1),[E,H]=o.useState(""),[G,Y]=o.useState(""),[q,U]=o.useState("#007cf0"),[P,Q]=o.useState(""),[W,X]=o.useState(""),[v,pe]=o.useState(!0),[w,ge]=o.useState(!0),[S,xe]=o.useState(!0),[he,ue]=o.useState([]),[Z,B]=o.useState(!1),[O,J]=o.useState([]),[i,_]=o.useState({isOpen:!1,type:"single"}),[p,K]=o.useState(!1),F=r=>{if(!r.dates||r.dates.length===0)return!1;const s=new Date().toISOString().split("T")[0];return r.dates.some(l=>l<s)},C=()=>{const r=m.filter(a=>!(!v&&!a.dates?.length||!w&&a.group_name||!S&&a.dates?.length)),s=new Map,l=[];return r.forEach(a=>{if(a.group_name){const d=a.group_name.replace(/ #\d+$/,"");s.has(d)||s.set(d,[]),s.get(d).push(a)}else l.push(a)}),[...Array.from(s.entries()).map(([a,d])=>({isGroup:!0,group_name:a,group_index:0,color:d[0].color,mark_type:d[0].mark_type,markers:d,lat:d[0].lat,lng:d[0].lng,height:d[0].height})),...l]};o.useEffect(()=>{f(),me()},[]);const me=async()=>{const{data:r,error:s}=await y.from("mark_types").select("value, label").order("label");s?console.error("Error loading mark types:",s):ue(r||[])};o.useEffect(()=>{if(b.current&&(b.current.remove(),b.current=null),g&&R.current){if(j.accessToken="pk.eyJ1Ijoib3BvcDI5IiwiYSI6ImNtZm8za3Q1NjAxcTEyanF4ZjZraWowdjEifQ.jNxrXsiX7Davmhjmp4ihWw",b.current=new j.Map({container:R.current,style:"mapbox://styles/mapbox/streets-v11",center:[g.lng,g.lat],zoom:15}),"isGroup"in g&&g.isGroup){const r=g;r.markers.forEach((s,l)=>{const x=new j.Popup({offset:25}).setHTML(`<strong>${s.label}</strong><br>Lat: ${s.lat}<br>Lng: ${s.lng}<br>Group: ${r.group_name}`),a=document.createElement("div");a.style.backgroundColor=r.color||"#007cf0",a.style.width="30px",a.style.height="30px",a.style.borderRadius="50%",a.style.border="2px solid white",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.fontSize="12px",a.style.fontWeight="bold",a.style.color="white",a.textContent=(l+1).toString(),a.setAttribute("aria-label","Map marker"),new j.Marker({element:a}).setLngLat([s.lng,s.lat]).setPopup(x).addTo(b.current)})}else if(!("isGroup"in g)||!g.isGroup){const r=g,s=new j.Popup({offset:25}).setHTML(`<strong>${r.label}</strong><br>Lat: ${r.lat}<br>Lng: ${r.lng}${r.group_name?`<br>Group: ${r.group_name}`:""}`);if(r.group_index){const l=document.createElement("div");l.style.backgroundColor=r.color||"#007cf0",l.style.width="30px",l.style.height="30px",l.style.borderRadius="50%",l.style.border="2px solid white",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.fontSize="12px",l.style.fontWeight="bold",l.style.color="white",l.textContent=r.group_index.toString(),l.setAttribute("aria-label","Map marker"),new j.Marker({element:l}).setLngLat([r.lng,r.lat]).setPopup(s).addTo(b.current)}else new j.Marker({color:r.color||"#007cf0"}).setLngLat([r.lng,r.lat]).setPopup(s).addTo(b.current)}}},[g]);async function f(){const{data:r,error:s}=await y.from("ar_pois").select("id, lat, lng, label, mark_type, color, height, dates, group_name, group_index");if(s){console.error("Error fetching POIs:",s);return}console.log("Fetched POIs:",r?.length||0,"markers"),ie(r||[])}async function ee(r){if(!r.id){console.error("No ID provided for update"),alert("Cannot save: Marker has no ID");return}console.log("Saving marker ID:",r.id,"Type:",typeof r.id),console.log("Update data:",{label:r.label,mark_type:r.mark_type,color:r.color,height:r.height,lat:r.lat,lng:r.lng});try{const{data:s,error:l}=await y.from("ar_pois").update({label:r.label,mark_type:r.mark_type,color:r.color,height:r.height,lat:r.lat,lng:r.lng}).eq("id",r.id).select();if(l){console.error("Supabase error updating marker:",l),alert("Failed to save changes: "+l.message);return}if(console.log("Update response data:",s),!s||s.length===0){console.warn("No rows were updated. Marker may not exist or ID mismatch."),alert("Warning: No changes were made. Please check if the marker exists.");return}console.log("Marker updated successfully, rows affected:",s.length),alert("Changes saved successfully!"),f(),n(null)}catch(s){console.error("Update failed with exception:",s),alert("Failed to save changes. Please try again.")}}async function re(r){if(console.log("deletePoi called with:",r),!r.id){console.error("No ID provided for deletion");return}try{console.log("Attempting to delete marker with ID:",r.id,"Label:",r.label);const{data:s,error:l}=await y.from("ar_pois").delete().eq("id",r.id).select();if(console.log("Supabase delete response - data:",s,"error:",l),l){console.error("Supabase error deleting marker:",l),alert(`Failed to delete marker: ${l.message}`);return}s&&s.length>0?console.log("Marker deleted successfully:",s[0]):console.warn("No marker was deleted - marker may not exist"),console.log("Refreshing POI list..."),await f(),n(null),h(null),console.log("Delete operation completed"),setTimeout(()=>{window.location.reload()},500)}catch(s){console.error("Delete operation failed with exception:",s),alert("Failed to delete marker. Please check console for details.")}}o.useEffect(()=>{if(M){const r=[];C().forEach(s=>{"isGroup"in s?s.markers.forEach(l=>r.push(l.id)):r.push(s.id)}),k(r)}else k([])},[M,m,v,w,S]);const be=r=>{k(s=>s.includes(r)?s.filter(l=>l!==r):[...s,r])},u=(r,s,l)=>{console.log("Delete clicked:",r,s?s.id||s.group_name:"no item",l),_({isOpen:!0,type:r,item:s,count:l})},fe=async()=>{K(!0);try{switch(console.log("Starting delete operation:",i.type,i.item),i.type){case"single":if(i.item){const r=i.item;console.log("Deleting single marker:",r.id,r.label),await re(r)}break;case"group":if(i.item){const r=i.item;console.log("Deleting group:",r.group_name,"with",r.markers.length,"markers");for(const s of r.markers)console.log("Deleting marker from group:",s.id,s.label),await re(s);console.log("Group deletion completed")}break;case"selected":console.log("Deleting selected markers"),await je();break;case"all":console.log("Deleting all markers"),await ye();break}console.log("Delete operation completed successfully"),_({isOpen:!1,type:"single"})}catch(r){console.error("Delete failed:",r),alert("Delete operation failed. Please try again.")}finally{K(!1)}};async function je(){if(c.length!==0)try{const{error:r}=await y.from("ar_pois").delete().in("id",c);if(r){console.error("Error deleting selected markers:",r),alert("Failed to delete selected markers. Please try again.");return}console.log("Selected markers deleted successfully:",c),f(),k([]),z(!1),n(null),h(null),setTimeout(()=>{window.location.reload()},500)}catch(r){console.error("Delete selected operation failed:",r),alert("Failed to delete selected markers. Please try again.")}}async function ye(){if(m.length!==0)try{const r=m.map(l=>l.id).filter(l=>l!==void 0),{error:s}=await y.from("ar_pois").delete().in("id",r);if(s){console.error("Error deleting all markers:",s),alert("Failed to delete all markers. Please try again.");return}console.log("All markers deleted successfully:",r.length,"markers"),f(),k([]),z(!1),n(null),h(null),setTimeout(()=>{window.location.reload()},500)}catch(r){console.error("Delete all operation failed:",r),alert("Failed to delete all markers. Please try again.")}}return e.jsxs(ve,{children:[e.jsx(te,{children:e.jsxs(se,{children:[e.jsx(le,{slot:"start",children:e.jsx(we,{})}),e.jsx(ae,{children:"Builded Pens"})]})}),e.jsx(ne,{className:"home-content",fullscreen:!0,children:e.jsxs("div",{className:"builded-wrap",children:[e.jsx("div",{className:"combined-container",children:e.jsxs("div",{className:"builded-card",children:[!t&&!Z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{children:"All Saved Markers"}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:e.jsx("button",{className:"btn",onClick:()=>B(!0),style:{padding:"8px 12px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"0.9rem"},children:"ðŸ“… View Calendar"})})]}),e.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"12px",padding:"16px",marginBottom:"16px",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx("h4",{style:{margin:"0 0 12px 0",color:"rgba(255, 255, 255, 0.9)",fontSize:"1rem",fontWeight:"600",textShadow:"0 1px 2px rgba(0, 0, 0, 0.2)"},children:"View Options"}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"6px 12px",background:v?"rgba(255, 255, 255, 0.1)":"rgba(255,255,255,0.05)",borderRadius:"8px",border:v?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.2s",backdropFilter:"blur(10px)"},children:[e.jsx("input",{type:"checkbox",checked:v,onChange:r=>pe(r.target.checked),style:{margin:0}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"500",color:"rgba(255, 255, 255, 0.9)"},children:"Permanent Marks"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"6px 12px",background:w?"rgba(255, 255, 255, 0.1)":"rgba(255,255,255,0.05)",borderRadius:"8px",border:w?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.2s",backdropFilter:"blur(10px)"},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:r=>ge(r.target.checked),style:{margin:0}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"500",color:"rgba(255, 255, 255, 0.9)"},children:"Group Marks"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"6px 12px",background:S?"rgba(255, 255, 255, 0.1)":"rgba(255,255,255,0.05)",borderRadius:"8px",border:S?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.2s",backdropFilter:"blur(10px)"},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:r=>xe(r.target.checked),style:{margin:0}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"500",color:"rgba(255, 255, 255, 0.9)"},children:"Dated Marks"})]})]})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"8px 12px",background:"rgba(255,255,255,0.08)",borderRadius:"8px",border:M?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease"},children:[e.jsx("input",{type:"checkbox",checked:M,onChange:r=>z(r.target.checked),style:{margin:0}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"500",color:"rgba(255, 255, 255, 0.9)"},children:"Select All"})]}),e.jsx("button",{className:"btn danger",onClick:()=>u("all",void 0,m.length),style:{padding:"8px 16px"},children:"ðŸ—‘ï¸ Delete All"}),e.jsxs("button",{className:"btn danger",onClick:()=>u("selected",void 0,c.length),disabled:c.length===0,style:{padding:"8px 16px"},children:["ðŸ—‘ï¸ Delete Selected (",c.length,")"]})]}),e.jsxs("div",{className:"poi-list",children:[C().map((r,s)=>"isGroup"in r?e.jsxs("div",{className:"poi-item",style:{position:"relative"},children:[r.markers.some(l=>F(l))&&e.jsx("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#ff4757",color:"white",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"bold",zIndex:10,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:"HAS OUTDATED"}),e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px"},children:e.jsx("input",{type:"checkbox",checked:r.markers.every(l=>c.includes(l.id)),onChange:()=>{const x=r.markers.every(a=>c.includes(a.id))?c.filter(a=>!r.markers.some(d=>d.id===a)):[...c,...r.markers.map(a=>a.id).filter(a=>!c.includes(a))];k(x)}})}),e.jsxs("div",{className:"poi-meta",children:[e.jsx("span",{className:"poi-label",children:r.group_name}),e.jsxs("span",{className:"poi-coords",children:[r.lat.toFixed(5),", ",r.lng.toFixed(5)]}),e.jsxs("span",{className:"poi-type",children:[r.mark_type," (Group)"]}),e.jsx("span",{className:"poi-color",style:{backgroundColor:r.color}}),e.jsxs("span",{className:"poi-height",children:[r.markers.length," markers"]}),r.markers.some(l=>F(l))&&e.jsx("div",{style:{marginTop:"8px",padding:"6px 10px",backgroundColor:"rgba(255, 71, 87, 0.1)",border:"1px solid rgba(255, 71, 87, 0.3)",borderRadius:"6px",color:"#ff4757",fontSize:"0.85rem",fontWeight:"500"},children:"âš ï¸ This group contains outdated marks - please review and update them"})]}),e.jsxs("div",{className:"poi-actions",children:[e.jsx("button",{className:"btn view",onClick:()=>n(r.markers[0]),children:"Details"}),e.jsx("button",{className:"btn edit",onClick:()=>n({...r.markers[0],editing:!0}),children:"Edit"}),e.jsx("button",{className:"btn view",onClick:()=>h(r),children:"View"}),e.jsx("button",{className:"btn danger",onClick:()=>u("group",r),children:"Delete"})]})]},`group-${r.group_name}-${r.group_index}`):e.jsxs("div",{className:"poi-item",style:{position:"relative"},children:[F(r)&&e.jsx("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#ff4757",color:"white",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"bold",zIndex:10,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:"OUTDATED"}),e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px"},children:e.jsx("input",{type:"checkbox",checked:c.includes(r.id),onChange:()=>be(r.id)})}),e.jsxs("div",{className:"poi-meta",children:[e.jsx("span",{className:"poi-label",children:r.label}),e.jsxs("span",{className:"poi-coords",children:[r.lat.toFixed(5),", ",r.lng.toFixed(5)]}),e.jsx("span",{className:"poi-type",children:r.mark_type}),e.jsx("span",{className:"poi-color",style:{backgroundColor:r.color}}),F(r)&&e.jsx("div",{style:{marginTop:"8px",padding:"6px 10px",backgroundColor:"rgba(255, 71, 87, 0.1)",border:"1px solid rgba(255, 71, 87, 0.3)",borderRadius:"6px",color:"#ff4757",fontSize:"0.85rem",fontWeight:"500"},children:"âš ï¸ This mark is outdated - please update or remove it"})]}),e.jsxs("div",{className:"poi-actions",children:[e.jsx("button",{className:"btn view",onClick:()=>n(r),children:"Details"}),e.jsx("button",{className:"btn edit",onClick:()=>n({...r,editing:!0}),children:"Edit"}),e.jsx("button",{className:"btn view",onClick:()=>h(r),children:"View"}),e.jsx("button",{className:"btn danger",onClick:()=>u("single",r),children:"Delete"})]})]},r.id)),m.length===0&&e.jsx("div",{className:"empty",children:"No markers saved yet."})]})]}),!t&&Z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{children:"Calendar View"}),e.jsx("button",{className:"btn",onClick:()=>{B(!1),J([])},style:{padding:"8px",background:"transparent",color:"#007cf0",border:"1px solid #007cf0"},children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",minHeight:"400px"},children:[e.jsx("div",{style:{marginBottom:"30px",padding:"20px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:e.jsx(Se,{presentation:"date",value:V,onIonChange:r=>{const s=r.detail.value;de(s);const x=new Date(s).toISOString().split("T")[0],a=m.filter(d=>d.dates&&d.dates.some(ke=>ke.startsWith(x)));J(a)},style:{"--background":"transparent","--color":"#007cf0"}})}),O.length>0&&e.jsxs("div",{style:{width:"100%",maxWidth:"600px"},children:[e.jsxs("h4",{style:{textAlign:"center",color:"rgba(255, 255, 255, 0.9)",marginBottom:"16px",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:["Markers for ",new Date(V).toLocaleDateString()]}),e.jsx("div",{className:"poi-list",style:{gridTemplateColumns:"1fr"},children:O.map(r=>e.jsxs("div",{className:"poi-item",style:{minHeight:"auto",padding:"16px",marginBottom:"12px"},children:[e.jsxs("div",{className:"poi-meta",style:{marginBottom:12},children:[e.jsx("span",{className:"poi-label",style:{fontSize:"1.1rem",fontWeight:"600"},children:r.label}),e.jsxs("span",{className:"poi-coords",style:{fontSize:"0.9rem"},children:[r.lat.toFixed(5),", ",r.lng.toFixed(5)]}),e.jsx("span",{className:"poi-type",style:{fontSize:"0.85rem"},children:r.mark_type}),e.jsx("span",{className:"poi-color",style:{backgroundColor:r.color}})]}),e.jsxs("div",{className:"poi-actions",style:{gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsx("button",{className:"btn view",onClick:()=>{n(r),B(!1)},children:"Details"}),e.jsx("button",{className:"btn view",onClick:()=>h(r),children:"View on Map"})]})]},r.id))})]}),O.length===0&&e.jsxs("div",{style:{textAlign:"center",color:"rgba(255, 255, 255, 0.7)",marginTop:"20px"},children:[e.jsx("p",{children:"No markers found for the selected date."}),e.jsx("p",{style:{fontSize:"0.9rem",marginTop:"8px"},children:"Try selecting a different date."})]})]})]}),t&&!("editing"in t&&t.editing)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{children:"isGroup"in t?"Group Details":"Marker Details"}),e.jsx("button",{className:"btn",onClick:()=>n(null),style:{padding:"8px",background:"transparent",color:"#007cf0",border:"1px solid #007cf0"},children:"âœ•"})]}),"isGroup"in t?e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"16px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"12px",marginBottom:16,border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Group Name:"})," ",t.group_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mark Type:"})," ",t.mark_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Color:"})," ",e.jsx("span",{style:{backgroundColor:t.color,display:"inline-block",width:"20px",height:"20px",borderRadius:"50%",marginLeft:"8px"}})," ",t.color]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Markers in Group:"})," ",t.markers.length]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("h4",{style:{marginBottom:"16px",color:"rgba(255, 255, 255, 0.9)",borderBottom:"2px solid rgba(255, 255, 255, 0.2)",paddingBottom:"8px",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:"All Markers in this Group:"}),e.jsx("div",{style:{display:"grid",gap:"12px"},children:t.markers.map((r,s)=>e.jsxs("div",{style:{padding:"16px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"12px",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",position:"relative",backdropFilter:"blur(10px)"},children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",backgroundColor:t.color,color:"white",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:s+1}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("h5",{style:{margin:"0 0 8px 0",color:"rgba(255, 255, 255, 0.9)",fontSize:"1.1rem",textShadow:"0 1px 2px rgba(0, 0, 0, 0.2)"},children:r.label}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("span",{style:{backgroundColor:t.color,width:"12px",height:"12px",borderRadius:"50%",display:"inline-block"}}),e.jsx("span",{style:{fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.7)"},children:t.mark_type})]})]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.7)"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"ðŸ“ Coordinates:"})," ",r.lat.toFixed(5),", ",r.lng.toFixed(5)]}),e.jsx("div",{children:r.dates&&r.dates.length>0?r.dates.length===1?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"ðŸ“… Saved on:"})," ",new Date(r.dates[0]).toLocaleDateString()]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"ðŸ“… Saved on multiple dates:"})," ",r.dates.map(l=>new Date(l).toLocaleDateString()).join(", ")]}):e.jsx(e.Fragment,{children:e.jsx("strong",{children:"This is a permanent mark"})})})]})]},r.id))})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{className:"btn edit",onClick:()=>n({...t,editing:!0}),children:"Edit Group"}),e.jsx("button",{className:"btn view",onClick:()=>h(t.markers[0]),style:{marginLeft:8},children:"View on Map"}),e.jsx("button",{className:"btn danger",onClick:()=>u("group",t),style:{marginLeft:8},children:"Delete Group"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"16px",background:"rgba(0, 124, 240, 0.05)",borderRadius:"12px",marginBottom:16},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Mark Type:"})," ",t.mark_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Color:"})," ",e.jsx("span",{style:{backgroundColor:t.color,display:"inline-block",width:"20px",height:"20px",borderRadius:"50%",marginLeft:"8px"}})," ",t.color]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Label:"})," ",t.label]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Coordinates:"})," ",t.lat.toFixed(5),", ",t.lng.toFixed(5)]}),t.dates&&t.dates.length>0?t.dates.length===1?e.jsxs("p",{children:[e.jsx("strong",{children:"Saved on:"})," ",new Date(t.dates[0]).toLocaleDateString()]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Saved on multiple dates:"})," ",t.dates.map(r=>new Date(r).toLocaleDateString()).join(", ")]}):e.jsx("p",{children:e.jsx("strong",{children:"This is a permanent mark"})}),t.group_name&&(()=>{const r=C().find(s=>"isGroup"in s&&s.markers.some(l=>l.id===t.id));return r?e.jsx("div",{style:{marginTop:"12px",padding:"8px 12px",background:"rgba(255, 193, 7, 0.1)",borderRadius:"8px",border:"1px solid rgba(255, 193, 7, 0.3)",backdropFilter:"blur(10px)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#856404"},children:[e.jsx("strong",{children:"ðŸ“Š Group Info:"}),' Part of "',r.group_name,'" group with ',r.markers.length," total markers"]})}):null})()]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{className:"btn edit",onClick:()=>n({...t,editing:!0}),children:"Edit"}),e.jsx("button",{className:"btn view",onClick:()=>h(t),style:{marginLeft:8},children:"View on Map"}),e.jsx("button",{className:"btn danger",onClick:()=>u("single",t),style:{marginLeft:8},children:"Delete Marker"})]})]})]}),t&&("editing"in t?t.editing:!1)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{children:"isGroup"in t?"Edit Group":"Edit Marker"}),e.jsx("button",{className:"btn",onClick:()=>n(null),style:{padding:"8px",background:"transparent",color:"#007cf0",border:"1px solid #007cf0"},children:"âœ•"})]}),"isGroup"in t?e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Select Marker to Edit"}),e.jsxs("select",{className:"input",onChange:r=>{const s=parseInt(r.target.value);s>=0&&n({...t.markers[s],editing:!0}),r.target.value="-1"},children:[e.jsx("option",{value:"-1",children:"Edit Group Properties"}),t.markers.map((r,s)=>e.jsxs("option",{value:s,children:["Edit Marker #",s+1,": ",r.label]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{className:"input",value:t.group_name,onChange:r=>n({...t,group_name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Mark Type"}),e.jsxs("select",{className:"input",value:t.mark_type,onChange:r=>n({...t,mark_type:r.target.value}),children:[e.jsx("option",{value:"building",children:"Building"}),e.jsx("option",{value:"department",children:"Department"}),e.jsx("option",{value:"events",children:"Events"}),e.jsx("option",{value:"rooms",children:"Rooms"}),e.jsx("option",{value:"hazard",children:"Hazard"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Color"}),e.jsx("input",{className:"input",type:"color",value:t.color,onChange:r=>n({...t,color:r.target.value})})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:12},children:[e.jsx("button",{className:"btn primary",onClick:()=>{t.markers.forEach((r,s)=>{const l=`${t.group_name} #${s+1}`;ee({...r,mark_type:t.mark_type,color:t.color,group_name:l})}),n(null)},children:"Save Group Changes"}),e.jsx("button",{className:"btn danger",onClick:()=>u("group",t),children:"Delete Entire Group"}),e.jsx("button",{className:"btn",onClick:()=>n(null),children:"Cancel"})]}),e.jsx("div",{style:{marginTop:12,padding:"12px",background:"rgba(255,107,107,0.08)",borderRadius:"8px",border:"1px solid rgba(255,107,107,0.2)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#e53e3e",fontWeight:"500"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Quick Delete:"})," You can also delete this group directly from the details view above."]})})]}):e.jsxs("div",{style:{display:"grid",gap:16},children:[t.group_name&&e.jsxs("div",{children:[e.jsx("label",{children:"Switch to Edit Other Markers in Group"}),e.jsxs("select",{className:"input",onChange:r=>{const s=parseInt(r.target.value);if(s>=0){const l=C().find(x=>"isGroup"in x&&x.markers.some(a=>a.id===t.id));l&&n({...l.markers[s],editing:!0})}r.target.value="-1"},children:[e.jsx("option",{value:"-1",children:"Select Marker to Edit"}),(()=>{const r=C().find(s=>"isGroup"in s&&s.markers.some(l=>l.id===t.id));return r?r.markers.map((s,l)=>e.jsxs("option",{value:l,children:["Edit Marker #",l+1,": ",s.label]},s.id)):null})()]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Label *"}),e.jsx("input",{className:"input",value:t.label,onChange:r=>n({...t,label:r.target.value}),placeholder:"Enter marker label",required:!0}),t.label.trim()===""&&e.jsx("div",{style:{color:"#e53e3e",fontSize:"0.8rem",marginTop:"4px"},children:"Label is required"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Mark Type"}),e.jsxs("select",{className:"input",value:t.mark_type,onChange:r=>n({...t,mark_type:r.target.value}),children:[e.jsx("option",{value:"building",children:"Building"}),e.jsx("option",{value:"department",children:"Department"}),e.jsx("option",{value:"events",children:"Events"}),e.jsx("option",{value:"rooms",children:"Rooms"}),e.jsx("option",{value:"hazard",children:"Hazard"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Color"}),e.jsx("input",{className:"input",type:"color",value:t.color,onChange:r=>n({...t,color:r.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Latitude *"}),e.jsx("input",{className:"input",type:"number",step:"0.00001",min:"-90",max:"90",value:t.lat,onChange:r=>n({...t,lat:Number(r.target.value)}),placeholder:"-90 to 90"}),(t.lat<-90||t.lat>90)&&e.jsx("div",{style:{color:"#e53e3e",fontSize:"0.8rem",marginTop:"4px"},children:"Latitude must be between -90 and 90"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Longitude *"}),e.jsx("input",{className:"input",type:"number",step:"0.00001",min:"-180",max:"180",value:t.lng,onChange:r=>n({...t,lng:Number(r.target.value)}),placeholder:"-180 to 180"}),(t.lng<-180||t.lng>180)&&e.jsx("div",{style:{color:"#e53e3e",fontSize:"0.8rem",marginTop:"4px"},children:"Longitude must be between -180 and 180"})]})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"rgba(0, 124, 240, 0.05)",borderRadius:"8px",border:"1px solid rgba(0, 124, 240, 0.2)"},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",color:"rgba(255, 255, 255, 0.9)",fontSize:"0.9rem"},children:"ðŸ“ Location Preview"}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"rgba(255, 255, 255, 0.7)"},children:[e.jsxs("div",{children:["Coordinates: ",t.lat.toFixed(5),", ",t.lng.toFixed(5)]}),e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx("span",{style:{backgroundColor:t.color,display:"inline-block",width:"12px",height:"12px",borderRadius:"50%",marginRight:"6px"}}),t.mark_type]})]})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn primary",onClick:()=>ee(t),disabled:t.label.trim()===""||t.lat<-90||t.lat>90||t.lng<-180||t.lng>180,children:"ðŸ’¾ Save Changes"}),e.jsx("button",{className:"btn",onClick:()=>{f(),n(null),setTimeout(()=>n({...t,editing:!1}),100)},style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},children:"ðŸ”„ Reset Changes"}),e.jsx("button",{className:"btn danger",onClick:()=>u("single",t),children:"ðŸ—‘ï¸ Delete Marker"}),e.jsx("button",{className:"btn",onClick:()=>n(null),children:"âŒ Cancel"})]}),e.jsx("div",{style:{marginTop:12,padding:"12px",background:"rgba(255,107,107,0.08)",borderRadius:"8px",border:"1px solid rgba(255,107,107,0.2)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#e53e3e",fontWeight:"500"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Quick Delete:"})," You can also delete this marker directly from the details view above."]})})]})]})]})}),e.jsx("div",{className:"map-container",children:e.jsxs("div",{className:"builded-card",children:[e.jsx("h3",{children:"Map View"}),g?e.jsx("div",{ref:R,style:{height:"100%"}}):e.jsxs("div",{style:{height:"100%",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("p",{children:"Map integration placeholder"}),e.jsx("p",{children:"Select a marker to view on map"})]})]})})]})}),e.jsxs(oe,{isOpen:i.isOpen,onDidDismiss:()=>_({isOpen:!1,type:"single"}),className:"delete-confirmation-modal",backdropDismiss:!1,style:{"--width":"auto","--height":"auto","--border-radius":"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{padding:"32px",background:"white",borderRadius:"16px",margin:"20px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)",maxWidth:"450px",position:"relative"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"linear-gradient(135deg, #ff6b6b, #ee5a52)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 12px 32px rgba(238, 90, 82, 0.4)",position:"relative"},children:e.jsx("div",{style:{width:"70px",height:"70px",borderRadius:"50%",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:e.jsx(N,{icon:L,style:{fontSize:"36px",color:"white"}})})}),e.jsx("h2",{style:{margin:"0 0 12px 0",color:"#1a202c",fontSize:"1.75rem",fontWeight:"700",letterSpacing:"-0.025em"},children:"Confirm Deletion"}),e.jsx("div",{style:{padding:"16px 20px",background:"rgba(255,107,107,0.08)",borderRadius:"12px",border:"1px solid rgba(255,107,107,0.2)",marginBottom:"8px"},children:e.jsxs("p",{style:{margin:0,color:"#2d3748",fontSize:"1.1rem",fontWeight:"500",lineHeight:"1.5"},children:[i.type==="single"&&i.item&&e.jsxs(e.Fragment,{children:["Are you sure you want to permanently delete ",e.jsxs("strong",{children:['"',i.item.label,'"']}),"?"]}),i.type==="group"&&i.item&&e.jsxs(e.Fragment,{children:["Are you sure you want to permanently delete the entire ",e.jsxs("strong",{children:['"',i.item.group_name,'"']})," group containing ",e.jsxs("strong",{children:[i.item.markers.length," markers"]}),"?"]}),i.type==="selected"&&e.jsxs(e.Fragment,{children:["Are you sure you want to permanently delete ",e.jsxs("strong",{children:[i.count," selected marker(s)"]}),"?"]}),i.type==="all"&&e.jsxs(e.Fragment,{children:["Are you sure you want to permanently delete ",e.jsx("strong",{children:"ALL markers"}),"? This action cannot be undone."]})]})}),e.jsx("p",{style:{margin:"8px 0 0 0",color:"#e53e3e",fontSize:"0.95rem",fontWeight:"600",fontStyle:"italic"},children:"âš ï¸ This action will permanently delete the data from the database and cannot be undone."})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>_({isOpen:!1,type:"single"}),disabled:p,style:{padding:"14px 28px",background:"linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%)",color:"#4a5568",border:"2px solid #e2e8f0",borderRadius:"12px",fontWeight:"600",fontSize:"1rem",cursor:p?"not-allowed":"pointer",opacity:p?.6:1,transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",minWidth:"120px"},onMouseOver:r=>{p||(r.currentTarget.style.transform="translateY(-1px)",r.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)")},onMouseOut:r=>{r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.05)"},children:"Cancel"}),e.jsxs("button",{onClick:fe,disabled:p,style:{padding:"14px 28px",background:p?"#9ca3af":"linear-gradient(135deg, #ff6b6b, #ee5a52)",color:"white",border:"none",borderRadius:"12px",fontWeight:"600",fontSize:"1rem",cursor:p?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"10px",minWidth:"140px",justifyContent:"center",transition:"all 0.2s ease",boxShadow:p?"none":"0 4px 16px rgba(238, 90, 82, 0.3)",position:"relative",overflow:"hidden"},onMouseOver:r=>{p||(r.currentTarget.style.transform="translateY(-2px)",r.currentTarget.style.boxShadow="0 8px 24px rgba(238, 90, 82, 0.4)")},onMouseOut:r=>{p||(r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="0 4px 16px rgba(238, 90, 82, 0.3)")},children:[p?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"18px",height:"18px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("span",{children:"Deleting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{icon:L,style:{fontSize:"18px"}}),e.jsx("span",{children:"Delete"})]}),!p&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"0",height:"0",borderRadius:"50%",background:"rgba(255,255,255,0.3)",transform:"translate(-50%, -50%)",transition:"width 0.6s, height 0.6s",pointerEvents:"none"},className:"ripple"})]})]})]}),e.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }

          .delete-confirmation-modal .modal-wrapper {
            --backdrop-opacity: 0.6;
            backdrop-filter: blur(8px);
          }

          .delete-confirmation-modal ion-backdrop {
            --backdrop-opacity: 0.6;
            backdrop-filter: blur(8px);
          }
        `})]}),e.jsxs(oe,{isOpen:ce,onDidDismiss:()=>T(!1),onDidPresent:()=>{setTimeout(()=>{const r=document.querySelector("ion-input input");r&&r.focus()},100)},children:[e.jsx(te,{children:e.jsxs(se,{children:[e.jsx(ae,{children:"Add Marker"}),e.jsx(le,{slot:"end",children:e.jsx(A,{onClick:()=>T(!1),children:e.jsx(N,{icon:L})})})]})}),e.jsxs(ne,{children:[e.jsxs(D,{children:[e.jsx(I,{position:"stacked",children:"Label"}),e.jsx($,{value:E,onIonChange:r=>H(r.detail.value),placeholder:"Enter marker label"})]}),e.jsxs(D,{children:[e.jsx(I,{position:"stacked",children:"Mark Type"}),e.jsx(Ce,{value:G,placeholder:"Select mark type",onIonChange:r=>Y(r.detail.value),children:he.map(r=>e.jsx(Ne,{value:r.value,children:r.label},r.value))})]}),e.jsxs(D,{children:[e.jsx(I,{position:"stacked",children:"Color"}),e.jsx("input",{type:"color",value:q,onChange:r=>U(r.target.value),style:{width:"100%",height:"40px",border:"none",borderRadius:"8px"}})]}),e.jsxs(D,{children:[e.jsx(I,{position:"stacked",children:"Latitude"}),e.jsx($,{type:"number",value:P,onIonChange:r=>Q(r.detail.value),placeholder:"Latitude"})]}),e.jsxs(D,{children:[e.jsx(I,{position:"stacked",children:"Longitude"}),e.jsx($,{type:"number",value:W,onIonChange:r=>X(r.detail.value),placeholder:"Longitude"})]}),e.jsxs(A,{expand:"full",onClick:async()=>{if(!P||!W||!E||!G){alert("Please fill all fields");return}const{error:r}=await y.from("ar_pois").insert({lat:Number(P),lng:Number(W),label:E,mark_type:G,color:q,height:1});r?(console.error("Error saving marker:",r),alert("Failed to save marker. Please try again.")):(console.log("Marker saved successfully"),T(!1),H(""),Y(""),U("#007cf0"),Q(""),X(""),f(),setTimeout(()=>{window.location.reload()},500))},color:"primary",children:[e.jsx(N,{icon:De,slot:"start"}),"Done"]}),e.jsxs(A,{expand:"full",onClick:()=>T(!1),color:"danger",children:[e.jsx(N,{icon:L,slot:"start"}),"Cancel"]})]})]})]})};export{ze as default};
