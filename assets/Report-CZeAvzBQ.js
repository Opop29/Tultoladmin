import{Q as re,j as e,v as N,d as b,w as k,x as z,y as S,z as M,e as w,s as le,k as n,A as ce,B as oe,C as D,D as m,E as c,F as o,G as d}from"./ionic-Bk_P96ZF.js";import{r as I}from"./vendor-NXI3fooF.js";import{o as de,l as xe,a as F,f as W,t as $,p as U,q as R,r as he,u as me,v as pe}from"./index-BCR8R_7f.js";import{s as P}from"./supabaseClient-DzfNh-zC.js";/* empty css             */import"./supabase-Dfjzly43.js";const be=()=>{const[t,Y]=I.useState(null),[q,T]=I.useState(!0),[C,B]=I.useState(null);re(()=>{j()});const K=s=>{if(!s.dates||s.dates.length===0)return!1;const i=new Date().toISOString().split("T")[0];return s.dates.reduce((l,h)=>h>l?h:l,s.dates[0])<i},j=async()=>{try{T(!0),B(null);const{data:s,error:i}=await P.from("mark_types").select("*");if(i)throw i;const x={};s?.forEach(a=>{x[a.value]=a.category});const{data:l,error:h}=await P.from("ar_pois").select("*");if(h)throw h;const p=l?.length||0,Z=(l?.sort((a,r)=>new Date(r.created_at).getTime()-new Date(a.created_at).getTime())||[]).slice(0,10),ee=l?.filter(a=>K(a))||[],g={},y={},u={},v={},f={};let A=0,L=0;l?.forEach(a=>{const r=a.mark_type||"Unknown";g[r]=(g[r]||0)+1;const O=a.color||"#007cf0";y[O]=(y[O]||0)+1;const E=x[r]||"Other";u[E]=(u[E]||0)+1,a.group_name&&A++,L+=a.height||1;const ae=Math.round(a.lat*10)/10,ne=Math.round(a.lng*10)/10,_=`${ae},${ne}`;v[_]=(v[_]||0)+1;const H=new Date(a.created_at),G=`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`;f[G]=(f[G]||0)+1});const se=p>0?L/p:0,te=Object.entries(v).sort(([,a],[,r])=>r-a).slice(0,5).map(([a,r])=>({coords:a,count:r})),ie=Object.entries(f).sort(([a],[r])=>a.localeCompare(r)).map(([a,r])=>({month:a,count:r}));Y({totalMarkers:p,totalGroups:A,markersByType:g,markersByColor:y,markersByCategory:u,recentActivity:Z,topLocations:te,dateDistribution:ie,averageHeight:se,outdatedMarkers:ee})}catch(s){console.error("Error loading report data:",s),B("Failed to load report data. Please try again.")}finally{T(!1)}},V=async s=>{await j(),s.detail.complete()},Q=s=>{try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},J=s=>({"#007cf0":"Blue","#00dfd8":"Teal","#ffc107":"Yellow","#dc3545":"Red","#28a745":"Green","#6f42c1":"Purple","#fd7e14":"Orange","#6c757d":"Gray"})[s]||s,X=s=>{if(!s.dates||s.dates.length===0)return"No expiration";const i=s.dates.reduce((x,l)=>l>x?l:x,s.dates[0]);return new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return q?e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(k,{children:[e.jsx(z,{slot:"start",children:e.jsx(S,{})}),e.jsx(M,{children:"Reports & Analytics"})]})}),e.jsx(w,{className:"home-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx(le,{name:"crescent"}),e.jsx("p",{children:"Loading report data..."})]})})]}):C?e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(k,{children:[e.jsx(z,{slot:"start",children:e.jsx(S,{})}),e.jsx(M,{children:"Reports & Analytics"})]})}),e.jsx(w,{className:"home-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx(n,{icon:de,size:"large",color:"danger"}),e.jsx("h3",{children:"Error Loading Reports"}),e.jsx("p",{children:C}),e.jsx("button",{className:"btn",onClick:j,children:"Try Again"})]})})]}):e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(k,{children:[e.jsx(z,{slot:"start",children:e.jsx(S,{})}),e.jsx(M,{children:"Reports & Analytics"})]})}),e.jsxs(w,{className:"home-content",children:[e.jsx(ce,{slot:"fixed",onIonRefresh:V,children:e.jsx(oe,{})}),e.jsxs("div",{className:"floating-shapes",children:[e.jsx("div",{className:"shape-1"}),e.jsx("div",{className:"shape-2"}),e.jsx("div",{className:"shape-3"}),e.jsx("div",{className:"shape-4"}),e.jsx("div",{className:"shape-5"})]}),e.jsx("div",{className:"wave-overlay"}),e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{className:"dashboard-section hero-section",children:e.jsxs("div",{className:"home-hero",children:[e.jsx("div",{className:"floating-particles"}),e.jsxs("div",{className:"hero-content",children:[e.jsx("div",{className:"hero-logo",children:e.jsx("img",{src:xe,alt:"Logo",className:"app-logo enhanced-logo"})}),e.jsxs("h1",{className:"home-title",children:[e.jsx("span",{className:"title-main",children:"üìä Analytics"}),e.jsx("span",{className:"title-accent",children:"& Reports"})]}),e.jsxs("div",{className:"hero-taglines",children:[e.jsx("p",{className:"tagline-primary",children:"Comprehensive insights into your AR marker ecosystem"}),e.jsx("p",{className:"tagline-secondary",children:"üìà Analyze ‚Ä¢ Track ‚Ä¢ Optimize"}),e.jsx("p",{className:"tagline-tertiary",children:"üìä Data-driven decisions for better AR experiences"})]})]})]})}),e.jsxs("div",{className:"dashboard-section stats-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"üìà Key Metrics"}),e.jsx("p",{className:"section-subtitle",children:"Essential statistics and performance indicators"})]}),e.jsx("div",{className:"section-content",children:e.jsx(D,{className:"stats-grid",children:e.jsxs(m,{children:[e.jsx(c,{size:"6",sizeMd:"6",sizeLg:"3",children:e.jsx(o,{className:"stat-card total-markers",children:e.jsxs(d,{children:[e.jsx("div",{className:"stat-icon",children:e.jsx(n,{icon:F})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h2",{children:t?.totalMarkers||0}),e.jsx("p",{children:"Total Markers"})]})]})})}),e.jsx(c,{size:"6",sizeMd:"6",sizeLg:"3",children:e.jsx(o,{className:"stat-card marker-types",children:e.jsxs(d,{children:[e.jsx("div",{className:"stat-icon",children:e.jsx(n,{icon:W})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h2",{children:Object.keys(t?.markersByType||{}).length}),e.jsx("p",{children:"Marker Types"})]})]})})}),e.jsx(c,{size:"6",sizeMd:"6",sizeLg:"3",children:e.jsx(o,{className:"stat-card recent-activity",children:e.jsxs(d,{children:[e.jsx("div",{className:"stat-icon",children:e.jsx(n,{icon:$})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h2",{children:t?.totalGroups||0}),e.jsx("p",{children:"Grouped Markers"})]})]})})}),e.jsx(c,{size:"6",sizeMd:"6",sizeLg:"3",children:e.jsx(o,{className:"stat-card quick-actions",children:e.jsxs(d,{children:[e.jsx("div",{className:"stat-icon",children:e.jsx(n,{icon:U})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h2",{children:Object.keys(t?.markersByColor||{}).length}),e.jsx("p",{children:"Color Variations"})]})]})})}),e.jsx(c,{size:"6",sizeMd:"6",sizeLg:"3",children:e.jsx(o,{className:"stat-card total-markers",children:e.jsxs(d,{children:[e.jsx("div",{className:"stat-icon",children:e.jsx(n,{icon:R})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h2",{children:t?.averageHeight?t.averageHeight.toFixed(1):"0"}),e.jsx("p",{children:"Average Height"})]})]})})})]})})})]}),e.jsxs("div",{className:"dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"üìä Detailed Analytics"}),e.jsx("p",{className:"section-subtitle",children:"In-depth analysis of your AR marker data"})]}),e.jsx("div",{className:"section-content",children:e.jsxs(D,{children:[e.jsxs(m,{children:[e.jsx(c,{size:"12",sizeLg:"6",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:W}),e.jsxs("div",{children:[e.jsx("h3",{children:"Marker Types Distribution"}),e.jsx("p",{children:"Breakdown of markers by type"})]})]}),e.jsx("div",{className:"chart-container",style:{marginTop:"16px"},children:Object.entries(t?.markersByType||{}).map(([s,i])=>e.jsxs("div",{className:"chart-item",style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[e.jsx("div",{className:"chart-label",style:{flex:1,fontSize:"14px"},children:s}),e.jsx("div",{className:"chart-bar",style:{flex:2,height:"8px",background:"#e0e0e0",borderRadius:"4px",margin:"0 8px"},children:e.jsx("div",{className:"chart-fill",style:{width:`${i/(t?.totalMarkers||1)*100}%`,height:"100%",background:"linear-gradient(90deg, #007cf0, #00dfd8)",borderRadius:"4px"}})}),e.jsx("div",{className:"chart-value",style:{width:"30px",textAlign:"right",fontSize:"14px"},children:i})]},s))})]})})}),e.jsx(c,{size:"12",sizeLg:"6",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:U}),e.jsxs("div",{children:[e.jsx("h3",{children:"Color Distribution"}),e.jsx("p",{children:"Markers grouped by color"})]})]}),e.jsx("div",{className:"color-distribution",style:{marginTop:"16px"},children:Object.entries(t?.markersByColor||{}).map(([s,i])=>e.jsxs("div",{className:"color-item",style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[e.jsx("div",{className:"color-swatch",style:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:s,marginRight:"12px"}}),e.jsx("span",{className:"color-name",style:{flex:1},children:J(s)}),e.jsxs("span",{className:"color-count",children:[i," markers"]})]},s))})]})})})]}),e.jsxs(m,{children:[e.jsx(c,{size:"12",sizeLg:"6",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:$}),e.jsxs("div",{children:[e.jsx("h3",{children:"Recent Activity"}),e.jsx("p",{children:"Latest marker additions"})]})]}),e.jsx("div",{className:"activity-list",style:{marginTop:"16px"},children:t?.recentActivity.slice(0,5).map((s,i)=>e.jsxs("div",{className:"activity-item",style:{display:"flex",alignItems:"center",marginBottom:"12px"},children:[e.jsx("div",{className:"activity-icon",style:{marginRight:"12px"},children:e.jsx(n,{icon:F})}),e.jsxs("div",{className:"activity-content",children:[e.jsx("div",{className:"activity-title",style:{fontWeight:"600",fontSize:"14px"},children:s.label}),e.jsxs("div",{className:"activity-meta",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"},children:[s.mark_type," ‚Ä¢ ",Q(s.created_at)]})]})]},s.id||i))})]})})}),e.jsx(c,{size:"12",sizeLg:"6",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:R}),e.jsxs("div",{children:[e.jsx("h3",{children:"Popular Locations"}),e.jsx("p",{children:"Most active marker areas"})]})]}),e.jsx("div",{className:"location-list",style:{marginTop:"16px"},children:t?.topLocations.map((s,i)=>e.jsxs("div",{className:"location-item",style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("div",{className:"location-rank",style:{width:"30px",fontWeight:"bold",color:"#60a5fa"},children:["#",i+1]}),e.jsxs("div",{className:"location-content",style:{flex:1},children:[e.jsx("div",{className:"location-coords",style:{fontSize:"14px"},children:s.coords}),e.jsxs("div",{className:"location-count",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"},children:[s.count," markers"]})]})]},i))})]})})})]}),e.jsx(m,{children:e.jsx(c,{size:"12",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:he}),e.jsxs("div",{children:[e.jsx("h3",{children:"üìÖ Marker Creation Timeline"}),e.jsx("p",{children:"Monthly marker creation trends and growth patterns"})]})]}),e.jsxs("div",{className:"timeline-container",style:{marginTop:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"12px 16px",background:"rgba(67, 233, 123, 0.1)",borderRadius:"8px",border:"1px solid rgba(67, 233, 123, 0.2)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(n,{icon:R,style:{marginRight:"8px",color:"#43e97b"}}),e.jsx("span",{style:{fontWeight:"600",fontSize:"14px"},children:"Creation Activity"})]}),e.jsxs("div",{style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"},children:["Total: ",t?.totalMarkers||0," markers"]})]}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:t?.dateDistribution.map((s,i)=>{const x=Math.max(s.count/(t?.totalMarkers||1)*100,2),l=Math.max(...t?.dateDistribution.map(p=>p.count)||[1]),h=s.count/l*100;return e.jsxs("div",{className:"timeline-item",style:{display:"flex",alignItems:"center",marginBottom:"12px",padding:"12px",background:"rgba(255,255,255,0.03)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.05)",transition:"all 0.3s ease"},children:[e.jsxs("div",{className:"timeline-month",style:{width:"100px",fontSize:"13px",fontWeight:"600",color:"rgba(255,255,255,0.9)",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx("span",{children:new Date(s.month+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"})}),e.jsx("span",{style:{fontSize:"10px",color:"rgba(255,255,255,0.5)",fontWeight:"400"},children:new Date(s.month+"-01").toLocaleDateString("en-US",{month:"long"})})]}),e.jsxs("div",{className:"timeline-bar",style:{flex:1,height:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",margin:"0 16px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{className:"timeline-fill",style:{width:`${x}%`,height:"100%",background:`linear-gradient(90deg, 
                                          rgba(67, 233, 123, ${.3+h/100*.7}), 
                                          rgba(56, 249, 215, ${.3+h/100*.7}))`,borderRadius:"8px",position:"relative",transition:"all 0.3s ease"},children:e.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shine 2s infinite"}})}),x>15&&e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"10px",fontWeight:"600",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:[x.toFixed(0),"%"]})]}),e.jsxs("div",{className:"timeline-count",style:{width:"80px",textAlign:"right",display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"rgba(255,255,255,0.9)"},children:s.count}),e.jsxs("div",{style:{fontSize:"10px",color:"rgba(255,255,255,0.5)"},children:["marker",s.count!==1?"s":""]})]})]},s.month)})}),t?.dateDistribution&&t.dateDistribution.length>0&&e.jsx("div",{style:{marginTop:"16px",padding:"12px",background:"rgba(67, 233, 123, 0.05)",borderRadius:"8px",border:"1px solid rgba(67, 233, 123, 0.1)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"},children:["üìä Most Active: ",t.dateDistribution.reduce((s,i)=>i.count>s.count?i:s).month," (",Math.max(...t.dateDistribution.map(s=>s.count))," markers)"]}),e.jsxs("div",{style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"},children:["üìà Average: ",(t.dateDistribution.reduce((s,i)=>s+i.count,0)/t.dateDistribution.length).toFixed(1)," per month"]})]})})]})]})})})}),e.jsx(m,{children:e.jsx(c,{size:"12",children:e.jsx(o,{className:"action-card",children:e.jsxs(d,{children:[e.jsxs("div",{className:"action-content",children:[e.jsx(n,{icon:me}),e.jsxs("div",{children:[e.jsx("h3",{children:"üìö Outdated Marks History"}),e.jsx("p",{children:"Markers that have expired and are no longer active"})]})]}),e.jsx("div",{className:"outdated-marks-container",style:{marginTop:"16px"},children:t?.outdatedMarkers.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"20px",color:"rgba(255,255,255,0.7)",fontSize:"14px"},children:[e.jsx(n,{icon:pe,size:"large",style:{marginBottom:"8px"}}),e.jsx("p",{children:"No outdated marks found"}),e.jsx("p",{style:{fontSize:"12px"},children:"All markers are currently active"})]}):e.jsxs("div",{className:"outdated-marks-list",children:[e.jsxs("div",{style:{padding:"8px 12px",background:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",marginBottom:"12px",fontSize:"12px",color:"rgba(255,255,255,0.8)",border:"1px solid rgba(220, 53, 69, 0.3)"},children:["üìä ",t?.outdatedMarkers.length," outdated marker",t?.outdatedMarkers.length!==1?"s":""," found"]}),e.jsx(D,{children:e.jsx(m,{children:t?.outdatedMarkers.map((s,i)=>e.jsx(c,{size:"12",sizeMd:"6",sizeLg:"3",children:e.jsxs("div",{className:"outdated-marker-item",style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"12px",padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",textAlign:"center",minHeight:"140px"},children:[e.jsx("div",{className:"marker-icon",style:{marginBottom:"8px"},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:s.color||"#007cf0",border:"2px solid rgba(255,255,255,0.3)",margin:"0 auto"}})}),e.jsxs("div",{className:"marker-content",style:{flex:1,width:"100%"},children:[e.jsx("div",{className:"marker-title",style:{fontWeight:"600",fontSize:"14px",marginBottom:"6px",lineHeight:"1.2"},children:s.label}),e.jsxs("div",{className:"marker-meta",style:{fontSize:"11px",color:"rgba(255,255,255,0.6)"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:e.jsx("span",{style:{display:"block"},children:s.mark_type})}),e.jsxs("div",{style:{color:"#ff6b6b",marginBottom:"4px",fontSize:"10px"},children:["Expired: ",X(s)]}),e.jsxs("div",{style:{fontSize:"10px",opacity:.8},children:["üìç ",s.lat.toFixed(3),", ",s.lng.toFixed(3)]}),s.group_name&&e.jsxs("div",{style:{fontSize:"10px",opacity:.8,marginTop:"2px"},children:["üë• ",s.group_name," #",s.group_index]})]})]})]})},s.id||i))})})]})})]})})})})]})})]})]})]})]})};export{be as default};
